<%@page language="abap" %>                                                                                                                                                                                                                                     
<!DOCTYPE html><html><head> <style> #map { height: 100%; }                                                                                                                                                                                                     
html, body { height: 100%; margin: 0; padding: 0; } </style> </head>                                                                                                                                                                                           
<body> <div id="map"></div> <script> function initMap() {                                                                                                                                                                                                      
var map = new google.maps.Map(document.getElementById('map'),                                                                                                                                                                                                  
{zoom: 1}); setMarkers(map); }                                                                                                                                                                                                                                 
var notifications= [                                                                                                                                                                                                                                           
<%                                                                                                                                                                                                                                                             
  LOOP AT g_notimap_list into data(ls_noti).                                                                                                                                                                                                                   
%>                                                                                                                                                                                                                                                             
  ['Notification: <%= |{ ls_noti-qmnum ALPHA = OUT }|%>  \n <%= ls_noti-qmtxt %>',<%= |{ ls_noti-latitude SIGN = LEFT }|  %>, <%= |{ ls_noti-longitude SIGN = LEFT }| %>,                                                                                      
'<%= |{ ls_noti-aufnr ALPHA = OUT }| %>','<%= |{ ls_noti-qmnum ALPHA = OUT }| %>', '<%= ls_noti-vornr %>',                                                                                                                                                     
 '<%= ls_noti-ltxa1 %>', '<%= ls_noti-ASTTX %>', '<%= ls_noti-arbpl %>', '<%= ls_noti-ktext %>'                                                                                                                                                                
<%                                                                                                                                                                                                                                                             
  if sy-tabix eq lines( g_notimap_list ).                                                                                                                                                                                                                      
%>                                                                                                                                                                                                                                                             
]                                                                                                                                                                                                                                                              
<%                                                                                                                                                                                                                                                             
  else.                                                                                                                                                                                                                                                        
%>                                                                                                                                                                                                                                                             
],                                                                                                                                                                                                                                                             
<%                                                                                                                                                                                                                                                             
  endif.                                                                                                                                                                                                                                                       
  endloop.                                                                                                                                                                                                                                                     
%>                                                                                                                                                                                                                                                             
];                                                                                                                                                                                                                                                             
function setMarkers(map) {                                                                                                                                                                                                                                     
var bounds = new google.maps.LatLngBounds();                                                                                                                                                                                                                   
var infowindow = new google.maps.InfoWindow({maxWidth: 250});                                                                                                                                                                                                  
for (var i = 0; i < notifications.length; i++) {                                                                                                                                                                                                               
var noti = notifications[i];                                                                                                                                                                                                                                   
var marker = new google.maps.Marker({                                                                                                                                                                                                                          
position: {lat: noti[1], lng: noti[2]}, map: map, title: noti[0], });                                                                                                                                                                                          
bounds.extend(marker.getPosition());                                                                                                                                                                                                                           
google.maps.event.addListener(marker, 'click', (function(marker, i) {                                                                                                                                                                                          
return function() {                                                                                                                                                                                                                                            
var contentString = '<div id="content"><table>' +                                                                                                                                                                                                              
'<tr><td><b>Work Order: </b></td><td>' + notifications[i][3] + '</td></tr><tr><td>' +                                                                                                                                                                          
'<b>User Status: </b></td><td>' + notifications[i][7] + '</td></tr><tr><td>';                                                                                                                                                                                  
if ( notifications[i][5] != "" ) {                                                                                                                                                                                                                             
contentString = contentString + '<b>Operation: </b></td><td>' + notifications[i][5] + '</td></tr><tr><td>' +                                                                                                                                                   
'<b>Desc: </b></td><td>' + notifications[i][6] + '</td></tr><tr><td>' +                                                                                                                                                                                        
'<b>WorkCenter: </b></td><td>' + notifications[i][8] + ' - ' + notifications[i][9] + '</td></tr><tr><td>';                                                                                                                                                     
}                                                                                                                                                                                                                                                              
contentString = contentString + '<b>Notification: </b></td><td>' + notifications[i][4] + '</td></tr></table></div>';                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
infowindow.setContent(contentString);                                                                                                                                                                                                                          
infowindow.open(map, marker); } })(marker, i)); }                                                                                                                                                                                                              
map.setCenter(bounds.getCenter()); map.fitBounds(bounds);                                                                                                                                                                                                      
map.setZoom(map.getZoom()-1);  } </script>                                                                                                                                                                                                                     
<script async defer src="https://maps.googleapis.com/maps/api/js?                                                                                                                                                                                              
key=<%=g_apikey %>&callback=initMap">                                                                                                                                                                                                                          
</script>   </body> </html>                                                                                                                                                                                                                                    